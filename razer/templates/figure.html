{% extends 'base.html' %}
{% load static %}
{% load i18n %}



{% block    body %}
    <div>Figures</div>
<div class="page-content-wrap">
    <div class="row">
        <div class="col-md-12">

            {% for key,value in figures.items %}
                <div id="{{ key }}" style="width: 900px;height:600px;"></div>
            {% endfor %}

        </div>
    </div>

</div>

{% endblock body %}


{% block    scripts %}
<script src="https://unpkg.com/angular-ui-router@1.0.0-beta.1/release/angular-ui-router.js"></script>
<script type="text/javascript" src="{% url 'javascript-catalog' %}"></script>
<script type="text/javascript">
    {% for key,value in figures.items %}
        var tem_{{ key }} = echarts.init(document.getElementById("{{ key }}"));
        {% if value.type == "heatmap" %}
            var option_{{ key }} = {
                title: {
                    text: '{{ value.title }}'
                },
                tooltip: {
                    position: 'top'
                },
                animation: false,
                grid: {
                    height: '50%',
                    top: '10%'
                },
                xAxis: {
                    type: 'category',
                    data: {{ value.x_label|safe }},
                    splitArea: {
                        show: true
                    }
                },
                yAxis: {
                    type: 'category',
                    data: {{ value.y_label|safe }},
                    splitArea: {
                        show: true
                    }
                },
                visualMap: {
                    min: {{ value.min }},
                    max: {{ value.max }},
                    calculable: true,
                    orient: 'horizontal',
                    left: 'center',
                    bottom: '15%'
                },
                series: [{
                    name: 'value',
                    type: 'heatmap',
                    data: {{ value.data|safe }},
                    label: {
                        show: true
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            };
        {% elif value.type == "line" %}
            var option_{{ key }} = {
                title: {
                    text: '{{ value.title }}'
                },
                toolbox: {
                    show: true,
                    feature: {
                        dataZoom: {
                            yAxisIndex: 'none'
                        }, //区域缩放，区域缩放还原
                        dataView: { 
                            readOnly: false
                        }, //数据视图
                        magicType: {
                            type: ['line', 'bar']
                        },  //切换为折线图，切换为柱状图
                        restore: {},  //还原
                        saveAsImage: {
                            show: true
                        }
                    }
                },
                legend: {
                    data: {{ value.y_label|safe }},
                    top: "6%"
                },
                xAxis: {
                    data: {{ value.x_label|safe }}
                },
                yAxis: {},
                series: [
                {% for key2, value2 in value.data.items %}
                    {
                        name: '{{key2}}',
                        type: 'line',
                        data: {{ value2|safe }},
                        label: {
                            show: true
                        },
                    },
                {% endfor %}
                ]
            };
        {% elif value.type == "pie" %}
            var option_{{ key }} = {
                title: {
                    text: '{{ value.title }}',
                    subtext: '',
                    left: 'center'
                },
                tooltip: {
                    trigger: 'item',
                    formatter: '{a} <br/>{b} : {c} ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    left: 'left',
                    data: {{ value.y_label|safe }},
                },
                series: [
                    {
                        name: '{{ value.feature }}',
                        type: 'pie',
                        radius: '60%',
                        center: ['50%', '60%'],
                        data: [
                            {% for key2, value2 in value.data.items %}
                                {value: {{ value2 }}, name: '{{ key2 }}'},
                            {% endfor %}
                        ],
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 20,
                                shadowOffsetX: 0,
                                shadowColor: 'rgba(0, 0, 0, 0.5)'
                            }
                        }
                    }
                ]
            };
        {% elif value.type == "range" %}
            function renderItem(params, api) {
                var xValue = api.value(0);
                var highPoint = api.coord([xValue, api.value(1)]);
                var lowPoint = api.coord([xValue, api.value(2)]);
                var halfWidth = 10;
                var style = api.style({
                    stroke: api.visual('color'),
                    fill: null
                });

                return {
                    type: 'group',
                    children: [{
                        type: 'line',
                        shape: {
                            x1: highPoint[0] - halfWidth, y1: highPoint[1],
                            x2: highPoint[0] + halfWidth, y2: highPoint[1]
                        },
                        style: style
                    }, {
                        type: 'line',
                        shape: {
                            x1: highPoint[0], y1: highPoint[1],
                            x2: lowPoint[0], y2: lowPoint[1]
                        },
                        style: style
                    }, {
                        type: 'line',
                        shape: {
                            x1: lowPoint[0] - halfWidth, y1: lowPoint[1],
                            x2: lowPoint[0] + halfWidth, y2: lowPoint[1]
                        },
                        style: style
                    }]
                };
            }
            var option_{{ key }} = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                title: {
                    text: '{{value.title}}'
                },
                legend: {
                    data: {{ value.y_label|safe }},
                    orient: 'horizontal',
                },
                xAxis: {
                    data: {{ value.x_label|safe }},
                },
                yAxis: {},
                series: [
                {% for sub_key, sub_value in value.error.items %}
                {
                    type: 'custom',
                    name: '{{sub_key}}_max',
                    renderItem: renderItem,
                    data: {{sub_value|safe}},
                    z:3,

                },
                {% endfor %}
                {% for sub_key, sub_value in value.line.items %}
                    {
                        name: '{{sub_key}}',
                        type: 'line',
                        data: {{ sub_value|safe }},
                        label: {
                            show: true
                        },
                    },
                {% endfor %}
                ]
            };

        {% endif %}
        tem_{{ key }}.setOption(option_{{ key }});
    {% endfor %}
</script>

{% endblock scripts %}
